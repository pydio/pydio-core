<?xml version="1.0" encoding="UTF-8"?>
<driver name="fs" className="class.fsDriver.php">
	<actions>
		<action name="ls" dirDefault="true">			
			<displayDefinitions>
				<display mode="list">
					<column messageId="1" attributeName="ajxp_label"/>
					<column messageId="2" attributeName="filesize"/>
					<column messageId="3" attributeName="mimestring"/>
					<column messageId="4" attributeName="ajxp_modiftime"/>
				</display>
			</displayDefinitions>
			<gui text="32" title="32" src="fileopen.png"
				accessKey="folder_access_key">
				<context selection="true" dir="" recycle="false"
					actionBar="false" actionBarGroup="get" contextMenu="true" infoPanel="true">
				</context>
				<selectionContext dir="true" file="true" recycle="false"
					unique="true" allowedMimes="AJXP_MIMES_ZIP">
				</selectionContext>
			</gui>
			<rightsContext noUser="true" userLogged="only" read="true"
				write="false" adminOnly="false">
			</rightsContext>
			<processing>
				<clientCallback prepareModal="true"><![CDATA[
					var path;					
					if(window.actionArguments && window.actionArguments.length>0){
						path = window.actionArguments[0];
						if(Object.isString(path)){path = new AjxpNode(path,false,getBaseName(path));}
					}else{
						userSelection = ajaxplorer.getUserSelection();
						if(userSelection && userSelection.isUnique() && (userSelection.hasDir() || userSelection.hasMime(["zip"]))){
							path = userSelection.getUniqueNode();
						}
					}
					if(path){
						ajaxplorer.updateContextData(path);
					}						
					]]></clientCallback>
				<serverCallback methodName="switchAction"></serverCallback>
			</processing>
		</action>
		<action name="upload">
			<gui text="27" title="27" src="yast_backup.png" accessKey="upload_access_key" hasAccessKey="true">
				<context selection="false" dir="true" recycle="hidden"
					actionBar="true" contextMenu="true" infoPanel="false"
					actionBarGroup="put" inZip="false">
				</context></gui>
			<rightsContext noUser="true" userLogged="only" read="true" write="true" adminOnly=""></rightsContext>
			<processing>
				<clientCallback prepareModal="true"><![CDATA[
				if(ajaxplorer.actionBar.getFlashVersion() >= 8 && (document.location.href.substring(0,5)!='https' || Prototype.Browser.IE) && flashUploaderEnabled)
				{
					modal.showDialogForm('Upload', 
										'flash_upload_form', 
										null, 
										function(){
											hideLightBox();
											return false;
										}, 
										null, 
										true, true);				
				}
				else
				{
					modal.showDialogForm('Upload', 
										'originalUploadForm', 
										function(oForm){
											ajaxplorer.actionBar.multi_selector = new MultiUploader(oForm, '6' );
										}, 
										null, 
										null, 
										true, true);					
				}				
					]]></clientCallback>
				<clientForm id="flash_upload_form"><![CDATA[
					<!-- UPLOAD FORM -->
					<form action="AJXP_SERVER_ACCESS" target="hidden_iframe" enctype="multipart/form-data" method="POST" id="originalUploadForm" style="text-align:left; display:none;" box_width="470">					
					<table>
						<tr>	
							<td id="fileInputContainer" valign="top" align="right">
								<input type="file" name="userfile_1" class="dialogFocus">
								<div id="uploadBrowseButton" class="fakeUploadButton" align="center"><img src="AJXP_CLIENT_RESOURCES_FOLDER/images/crystal/actions/22/view_list_details.png"><br/>AJXP_MESSAGE[171]</div>
								<div id="uploadSendButton" class="fakeUploadButton" align="center"><img src="AJXP_CLIENT_RESOURCES_FOLDER/images/crystal/actions/22/yast_backup.png"><br/>AJXP_MESSAGE[77]</div>
							</td>
							<td rowspan="2" id="uploadFilesListContainer" valign="top">
								<div id="upload_files_list" class="uploadFilesList"></div>
							</td>
						</tr>
						<tr>	
							<td valign="bottom" align="right">
								<div class="fakeUploadButton fakeOptionButton" id="uploadOptionsButton" align="center">AJXP_MESSAGE[310]</div>
								<div class="fakeUploadButton fakeOptionButton" id="uploadCloseButton" align="center">AJXP_MESSAGE[86]</div>
							</td>
						</tr>
					</table>
					<input type="hidden" name="get_action" value="upload">	
					</form>
					
					<!-- FLEX UPLOAD FORM -->
					<div id="flash_upload_form" box_width="470">
					<div id="flashscreen">
					<iframe id="flashframe" frameborder="0" src="AJXP_SERVER_ACCESS?get_action=get_template&template_name=flash_tpl.html&encode=false"></iframe>
					</div>
					</div>
					<script language="javascript">$('originalUploadForm').hide();</script>
				]]></clientForm>
				<serverCallback methodName="switchAction"></serverCallback>
				</processing>
		</action>
		<action name="empty_recycle">
			<gui text="220" title="221" src="trashcan_empty.png" accessKey="empty_recycle_access_key" hasAccessKey="true">
				<context selection="false" dir="true" recycle="only" actionBar="true" contextMenu="true" infoPanel="false" actionBarGroup="default"></context>
			</gui>
			<rightsContext noUser="true" userLogged="" read="true" write="true" adminOnly=""></rightsContext>
			<processing>
				<clientCallback prepareModal="false"><![CDATA[
				    ajaxplorer.getContextHolder().selectAll();
				    ajaxplorer.actionBar.fireAction('delete');
					]]></clientCallback>
				<serverCallback methodName="switchAction"></serverCallback>
				</processing>
		</action>
		<action name="mkdir">			
			<gui text="154" title="155" src="folder_new.png" accessKey="folder_access_key" hasAccessKey="true">
				<context selection="false" dir="true" recycle="hidden" actionBar="true" contextMenu="true" infoPanel="false" actionBarGroup="put" inZip="false"></context>
			</gui>
			<rightsContext noUser="true" userLogged="only" read="true" write="true" adminOnly=""></rightsContext>
			<processing>
				<clientCallback prepareModal="true"><![CDATA[					
					modal.showDialogForm('Create', 'mkdir_form', null, function(){
						var oForm = $(modal.getForm());	
						var elementToCheck=(oForm['dirname']);
						if(ajaxplorer.getContextHolder().fileNameExists($(elementToCheck).getValue()))
						{
							alert(MessageHash[125]);
							return false;
						}
						ajaxplorer.actionBar.submitForm(oForm);				
						hideLightBox(true);
						return false;
					});
					]]></clientCallback>
				<clientForm id="mkdir_form"><![CDATA[
				<div id="mkdir_form" action="mkdir" box_width="280">
				AJXP_MESSAGE[173]<br/>
				<input type="text" name="dirname" size="30" class="dialogFocus">
				</div>
				]]></clientForm>
				<serverCallback methodName="switchAction"></serverCallback>
				</processing>
		</action>
		<action name="mkfile">
			<gui text="156" title="157" src="filenew.png" accessKey="file_access_key" hasAccessKey="true">
				<context selection="false" dir="true" recycle="hidden"
					actionBar="true" contextMenu="true" infoPanel="false"
					actionBarGroup="put" inZip="false">
				</context></gui>
			<rightsContext noUser="true" userLogged="only" read="true" write="true" adminOnly=""></rightsContext>
			<processing>
				<clientCallback prepareModal="true"><![CDATA[
					modal.showDialogForm('Create', 'mkfile_form', null, function(){
						var oForm = $(modal.getForm());	
						var elementToCheck=(oForm['filename']);
						if(ajaxplorer.getContextHolder().fileNameExists($(elementToCheck).getValue()))
						{
							alert(MessageHash[125]);
							return false;
						}
						ajaxplorer.actionBar.submitForm(oForm);				
						hideLightBox(true);
						return false;
					});
					]]></clientCallback>
				<clientForm id="mkfile_form"><![CDATA[
<div id="mkfile_form" action="mkfile" box_width="280">
AJXP_MESSAGE[174]<br/>
<input type="text" name="filename" size="30" class="dialogFocus">
</div>				]]></clientForm>
				<serverCallback methodName="switchAction"></serverCallback>
				</processing>
		</action>
		<action name="download" fileDefault="true">
			<gui text="88" title="88" src="download_manager.png" accessKey="download_access_key" hasAccessKey="true">
				<context selection="true" dir="" recycle="false"
					actionBar="true" contextMenu="true" infoPanel="true"
					actionBarGroup="get">
				</context>
				<selectionContext dir="true" file="true" recycle="false" unique="false"></selectionContext></gui>
			<rightsContext noUser="true" userLogged="only" read="true" write="false" adminOnly=""></rightsContext>
			<processing>
				<clientCallback prepareModal="true"><![CDATA[
					var userSelection = ajaxplorer.getUserSelection();
					if((userSelection.isUnique() && !userSelection.hasDir()) || (zipEnabled && multipleFilesDownloadEnabled))
					{
						$('download_form').select("input").each(function(input){
							if(input.name!='get_action') input.remove();
						});
						userSelection.updateFormOrUrl($('download_form'));
						$('download_form').submit();
						fileNames = userSelection.getFileNames();						
						for(var i=0; i<fileNames.length;i++){
							gaTrackEvent("Data", "Download", fileNames[i]);
						}												
					}
					else
					{
						var loadFunc = function(oForm){
							var dObject = oForm.getElementsBySelector('div[id="multiple_download_container"]')[0];
							var downloader = new MultiDownloader(dObject, ajxpServerAccessPath+'?action=download&file=');
							downloader.triggerEnd = function(){hideLightBox()};
							fileNames = userSelection.getFileNames();
							for(var i=0; i<fileNames.length;i++)
							{
								downloader.addListRow(fileNames[i]);
							}				
						};
						var closeFunc = function(){
							hideLightBox();
							return false;
						};
						modal.showDialogForm('Download Multiple', 'multi_download_form', loadFunc, closeFunc, null, true);
					}
					]]></clientCallback>
					<clientForm id="multi_download_form"><![CDATA[
					<div id="multi_download_form" title="AJXP_MESSAGE[118]"  box_width="345">
					<div class="dialogLegend">AJXP_MESSAGE[119]</div><br/>
					<div id="multiple_download_container"></div>
					<form style="display:inline;" action="content.php" method="GET" id="download_form" target="download_iframe">
						<input type="hidden" name="get_action" value="download">
					</form>
					<iframe id="download_iframe" name="download_iframe" style="display:none"></iframe>					
					</div>]]>
					</clientForm>
					<clientListener name="selectionChange"><![CDATA[
					if(ajaxplorer){
						var userSelection = ajaxplorer.getUserSelection();
						var action = ajaxplorer.getActionBar().getActionByName("download");
						if(zipEnabled && multipleFilesDownloadEnabled){
							if(action){
								if((userSelection.isUnique() && !userSelection.hasDir()) || userSelection.isEmpty()){
									action.setIconSrc('download_manager.png');
								}else{
									action.setIconSrc('accessories-archiver.png');
								}
							}
						}else{
							if(userSelection.hasDir() && action){
								action.selectionContext.dir = false;
							}
						}
					}
					]]></clientListener>
				<serverCallback methodName="switchAction"></serverCallback>
				</processing>
		</action>
		<action name="compress">
			<gui text="313" title="314" src="archive_insert.png" accessKey="" hasAccessKey="false">
				<context selection="true" dir="" recycle="false"
					actionBar="false" contextMenu="true" infoPanel="true"
					actionBarGroup="get" inZip="false">
				</context>
				<selectionContext dir="true" file="file" recycle="false" unique="false"></selectionContext></gui>
			<rightsContext noUser="true" userLogged="only" read="true" write="false" adminOnly=""></rightsContext>
			<processing>
				<clientCallback prepareModal="true"><![CDATA[
					var userSelection = ajaxplorer.getUserSelection();					
					if((zipEnabled && multipleFilesDownloadEnabled))
					{
						var loadFunc = function(oForm){
							var zipName;
							if(userSelection.isUnique()){
								zipName = getBaseName(userSelection.getUniqueFileName());
								if(!userSelection.hasDir()) zipName = zipName.substr(0, zipName.lastIndexOf("\."));
							}else{
								zipName = getBaseName(userSelection.getContextNode().getPath());
								if(zipName == "") zipName = "Archive";
							}
							var index=1;
							var buff = zipName;
							while(userSelection.fileNameExists(zipName + ".zip")){
								zipName = buff + "-" + index; index ++ ;
							}
							oForm.select('input[id="archive_name"]')[0].value = zipName + ".zip" ;
						};
						var closeFunc = function(){
							userSelection.updateFormOrUrl(modal.getForm());
							ajaxplorer.actionBar.submitForm(modal.getForm());			
							hideLightBox();
						};
						modal.showDialogForm('Compress selection to ...', 'compress_form', loadFunc, closeFunc);
					}
				]]></clientCallback>
				<clientForm id="compress_form"><![CDATA[
				<div id="compress_form" action="compress" box_width="280">
					AJXP_MESSAGE[315]<br/>
					<input type="text" name="archive_name" value="" id="archive_name" class="dialogFocus initFicName">
				</div>
				]]></clientForm>					
				<clientListener name="selectionChange"><![CDATA[
				if(ajaxplorer){
					var userSelection = ajaxplorer.getUserSelection();
					var action = ajaxplorer.getActionBar().getActionByName("compress");
					if(!zipEnabled || !multipleFilesDownloadEnabled){
						if(action){
							if(userSelection.isUnique()) action.selectionContext.multipleOnly = true;
							else action.selectionContext.unique = true;
						}
					}
				}
				]]></clientListener>				
				<serverCallback methodName="switchAction"></serverCallback>
				</processing>
		</action>
		<action name="public_url" fileDefault="false">
			<gui text="292" title="292" src="public_url.png" hasAccessKey="false">
				<context selection="true" dir="" recycle="false"
					actionBar="true" contextMenu="true" infoPanel="true"
					actionBarGroup="get">
				</context>
				<selectionContext dir="false" file="true" recycle="false" unique="true"></selectionContext></gui>
			<rightsContext noUser="true" userLogged="only" read="true" write="false" adminOnly=""></rightsContext>
			<processing>
				<clientCallback prepareModal="true"><![CDATA[
					if(!window.ajxpPublicUrlCallback){
						window.ajxpPublicUrlCallback = function(){
							var userSelection = ajaxplorer.getUserSelection();
							if(!userSelection.isUnique() || userSelection.hasDir()) return;
							var publicUrl = ajxpServerAccessPath+'?get_action=public_url';
							publicUrl = userSelection.updateFormOrUrl(null,publicUrl);
	                        var oForm = $(modal.getForm());	                        
	                        var conn = new Connexion(publicUrl);
	                        conn.setParameters(oForm.serialize(true));
	                        conn.addParameter('get_action','public_url');
	                        conn.onComplete = function(transport){
	                        	var cont = oForm.select('input[id="public_url_container"]')[0];
	                        	if(cont){
	                        		cont.value = transport.responseText;
	                        		cont.select();
	                        	}
                                var email = oForm.select('a[id="email"]')[0];
                                if (email){ 
                                    email.setAttribute('href', 'mailto:unknown@unknown.com?Subject=UPLOAD&Body='+transport.responseText); 
                                }
	                        	modal.refreshDialogAppearance();
	                        };
	                        conn.sendSync();
	                    };
                    }
                    modal.showDialogForm('Get', 'public_url_form', null, function(){
                        hideLightBox(true);
                        return false;
                    }, null, true);
					]]></clientCallback>
					<clientForm id="public_url"><![CDATA[
					<div id="public_url_form" title="AJXP_MESSAGE[293]"  box_width="280" action="public_url">
						<fieldset>
							<legend>1 : AJXP_MESSAGE[307]</legend>
							<div class="dialogLegend">
								<input type="text" style="width: 25px; float: right;" value="0" name="expiration"/>
								<span message_id="294">AJXP_MESSAGE[294]</span> 
							</div>
							<div class="dialogLegend" style="clear: both; margin-top: 10px;">
								<input type="password" value="" name="password" style="float: right; width: 100px;"/>
								<span message_id="295">AJXP_MESSAGE[295]</span>
							</div>
						</fieldset>
						<fieldset>
							<legend>2 : AJXP_MESSAGE[308]</legend>
							<div align="center" style="color: white; margin-top:5px; font-size:10px;">
								<div align="center" style="text-align:center; cursor: pointer; width:50px; border: 1px solid #aaa;background-color: #bbb;padding:5 10 3 10;" onclick="window.ajxpPublicUrlCallback(); return false;"><img src="client/images/crystal/actions/22/public_url.png" height="22" width="22"/><br/>AJXP_MESSAGE[309]</div>
							</div>
						</fieldset>
						<fieldset>
							<legend>3 : AJXP_MESSAGE[296]</legend>
							<input type="text" style="width:230px;" id="public_url_container"/><br/>
                            <a id="email"> AJXP_MESSAGE[323] </a>
						</fieldset>
					</div>
					]]>
					</clientForm>					
				<serverCallback methodName="switchAction"></serverCallback>
				</processing>
		</action>
		<action name="open_with">
			<gui text="316" title="316" src="fileopen.png" accessKey="open_with_access" hasAccessKey="true">
				<context selection="true" dir="" recycle="hidden"  behaviour="hidden"
					actionBar="true" contextMenu="true" infoPanel="false"
					actionBarGroup="get" inZip="false">
				</context>
				<selectionContext dir="false" file="true" recycle="false" unique="true" allowedMimes="AJXP_MIMES_EDITABLE,AJXP_MIMES_IMAGE" behaviour="hidden"></selectionContext></gui>
			<rightsContext noUser="true" userLogged="only" read="true" write="false" adminOnly=""></rightsContext>
			<subMenu>
				<dynamicBuilder><![CDATA[
					var context = window.builderContext;
					context.builderMenuItems = $A([]);					
					var selectedMime = getAjxpMimeType(ajaxplorer.getUserSelection().getUniqueNode());
					var editors = ajaxplorer.findEditorsForMime(selectedMime);
					if(editors.length){
						var index = 0;
						editors.each(function(el){
							context.builderMenuItems.push({
								name:el.text,
								alt:el.title,
								isDefault : (index == 0),
								image:resolveImageSource(el.icon, '/images/crystal/actions/ICON_SIZE', 22),
								callback:function(e){this.apply([el]);}.bind(context)
							} );
							index++;
						} );					
					}else{
						context.builderMenuItems.push({
							name:MessageHash[324],
							alt:MessageHash[324],
							image:resolveImageSource('button_cancel.png', '/images/crystal/actions/ICON_SIZE', 22),
							callback:function(e){}
						} );					
					}
				]]></dynamicBuilder>
			</subMenu>			
			<processing>			
				<clientCallback prepareModal="false"><![CDATA[		
					var editorData = window.actionArguments[0];
					if(!editorData){
						var selectedMime = getAjxpMimeType(ajaxplorer.getUserSelection().getUniqueNode());
						var editors = ajaxplorer.findEditorsForMime(selectedMime);
						if(editors.length){
							editorData = editors[0];							
						}					
					}
					if(editorData){
						ajaxplorer.loadEditorResources(editorData.resourcesManager);
						modal.openEditorDialog(editorData);
					}else{
						console.log('no data');
					}
				]]></clientCallback>
				<serverCallback methodName="switchAction"></serverCallback>
				</processing>
		</action>
		<action name="slideshow_sel">
			<gui text="234" title="234" src="frame_image.png" accessKey="" hasAccessKey="false">
				<context selection="true" dir="" recycle="hidden"
					actionBar="false" contextMenu="false" infoPanel="true"
					actionBarGroup="get">
				</context>
				<selectionContext dir="true" file="true" recycle="true" unique="false" multipleOnly="true" allowedMimes="AJXP_MIMES_IMAGE" behaviour="hidden"></selectionContext></gui>
			<rightsContext noUser="true" userLogged="only" read="true" write="false" adminOnly=""></rightsContext>
			<processing>
				<clientCallback prepareModal="true"><![CDATA[					
					var selectedMime = getAjxpMimeType(ajaxplorer.getUserSelection().getUniqueNode());
					var editors = ajaxplorer.findEditorsForMime(selectedMime);
					var editorData;
					if(editors.length){
						editorData = editors[0];							
					}					
					if(editorData){
						ajaxplorer.loadEditorResources(editorData.resourcesManager);
						modal.openEditorDialog(editorData);
					}else{
						console.log('no data');
					}
					]]></clientCallback>
				<serverCallback methodName="switchAction"></serverCallback>
				</processing>
		</action>
		<action name="chmod">
			<gui text="287" title="287" src="ksysv.png" accessKey="" hasAccessKey="false">
				<context selection="true" dir="true" recycle="hidden"  behaviour="hidden"
					actionBar="false" contextMenu="true" infoPanel="true"
					actionBarGroup="put" inZip="false">
				</context>
				<selectionContext dir="true" file="true" recycle="false" unique="false" allowedMimes="" behaviour="hidden"></selectionContext></gui>
			<rightsContext noUser="true" userLogged="only" read="true" write="true" adminOnly=""></rightsContext>
			<processing>
				<clientCallback prepareModal="true"><![CDATA[
					var userSelection =  ajaxplorer.getUserSelection();					
					var loadFunc = function(oForm){
						ajaxplorer.actionBar.propertyPane = new PropertyPanel(userSelection, oForm);
					};
					var completeFunc = function(){
						if(!ajaxplorer.actionBar.propertyPane.valueChanged()){
							hideLightBox();
							return false;					
						}
						userSelection.updateFormOrUrl(modal.getForm());
						ajaxplorer.actionBar.submitForm(modal.getForm());
						hideLightBox();
						return false;
					};
					modal.showDialogForm('Edit Online', 'properties_box', loadFunc, completeFunc);
					]]></clientCallback>
				<clientForm id="properties_box"><![CDATA[
					<div id="properties_box" action="chmod" box_width="200"></div>				
				]]></clientForm>
				<serverCallback methodName="switchAction"></serverCallback>
				</processing>
		</action>
		<action name="restore">
			<gui text="222" title="223" src="folder1_important.png" accessKey="restore_access_key" hasAccessKey="true">
				<context selection="true" dir="" recycle="only"
					actionBar="true" contextMenu="true" infoPanel="false"
					actionBarGroup="change">
				</context>
				<selectionContext dir="true" file="true" recycle="false" unique="true" image="false" mp3="false" editable="false"></selectionContext></gui>
			<rightsContext noUser="true" userLogged="only" read="true" write="true" adminOnly=""></rightsContext>
			<processing>
				<clientCallback prepareModal="true"><![CDATA[
				   var userSelection = ajaxplorer.getUserSelection();
				   var fileNames = $A(userSelection.getFileNames());
				   var connexion = new Connexion();
				   connexion.addParameter('get_action', 'restore');
				   connexion.addParameter('dir', userSelection.getCurrentRep());
				   connexion.onComplete = function(transport){
				   		ajaxplorer.actionBar.parseXmlMessage(transport.responseXML);
				   };
				   fileNames.each(function(filename){
				   		connexion.addParameter('file', filename);
				   		connexion.sendAsync();
				   });
					]]></clientCallback>
				<serverCallback methodName="switchAction"></serverCallback>
				</processing>
		</action>
		<action name="rename">
			<gui text="6" title="158" src="applix.png" accessKey="rename_access_key" hasAccessKey="true">
				<context selection="true" dir="" recycle="hidden"
					actionBar="true" contextMenu="true" infoPanel="false"
					actionBarGroup="change" inZip="false">
				</context>
				<selectionContext dir="true" file="true" recycle="false" unique="true" image="false" mp3="false" editable="false"></selectionContext></gui>
			<rightsContext noUser="true" userLogged="only" read="true" write="true" adminOnly=""></rightsContext>
			<processing>
				<clientCallback prepareModal="true"><![CDATA[
					var callback = function(item, newValue){						
						var filename = item.getAttribute('filename');
						var conn = new Connexion();
						conn.addParameter('get_action', 'rename');
						conn.addParameter('file', filename);
						conn.addParameter('filename_new', newValue);
						conn.onComplete = function(transport){
							ajaxplorer.actionBar.parseXmlMessage(transport.responseXML);
						};
						conn.sendSync();
					};
					if(ajaxplorer.getUserSelection() && ajaxplorer.getUserSelection().getSelectionSource() && ajaxplorer.getUserSelection().getSelectionSource().switchCurrentLabelToEdition) {ajaxplorer.getUserSelection().getSelectionSource().switchCurrentLabelToEdition(callback);}
				]]></clientCallback>
				<serverCallback methodName="switchAction"></serverCallback>
				</processing>
		</action>
		<action name="copy" ctrlDragndropDefault="true">
			<gui text="66" title="159" src="editcopy.png" accessKey="copy_access_key" hasAccessKey="true">
				<context selection="true" dir="" recycle="hidden"
					actionBar="true" contextMenu="true" infoPanel="false"
					actionBarGroup="change">
				</context>
				<selectionContext dir="true" file="true" recycle="false" unique="false" image="false" mp3="false" editable="false"></selectionContext></gui>
			<rightsContext noUser="true" userLogged="only" read="true" write="true" adminOnly=""></rightsContext>
			<processing>
				<clientCallback prepareModal="true"><![CDATA[
					if(ajaxplorer.user){
						var activeRepository = ajaxplorer.user.getActiveRepository();
					}
					var onLoad = function(oForm){
						var getAction = oForm.getElementsBySelector('input[name="get_action"]')[0];
						getAction.value = 'copy';
						var container = oForm.getElementsBySelector(".treeCopyContainer")[0];
						var eDestLabel = oForm.getElementsBySelector('input[name="dest"]')[0];
						var eDestNodeHidden = oForm.getElementsBySelector('input[name="dest_node"]')[0];
						$('external_repository').hide();
						
						if(!this.treeCopy){
							var action = function(e){
								if(ajaxplorer.actionBar.treeCopyActive){
						  			if(ajaxplorer.actionBar.treeCopyActionDest) 
						  				ajaxplorer.actionBar.treeCopyActionDest.each(function(element){element.value = this.url}.bind(this));
					 				if(ajaxplorer.actionBar.treeCopyActionDestNode) 
					 					ajaxplorer.actionBar.treeCopyActionDestNode.each(function(element){element.value = this.id}.bind(this));
					 			}
					 			this.select();
							};						
							this.treeCopy = new WebFXLoadTree('/', 
																ajxpServerAccessPath+'?get_action=ls', 
																action, 
																'explorer', null, null, '&options=d');
						}
						else{
							window.setTimeout('ajaxplorer.actionBar.treeCopy.reload()', 100);
						}				
						this.treeCopyActive = true;
						this.treeCopyActionDest = $A([eDestLabel]);
						this.treeCopyActionDestNode = $A([eDestNodeHidden]);
						container.innerHTML = this.treeCopy.toString();
						$(this.treeCopy.id).observe("click", function(e){
							this.action();
							Event.stop(e);
						}.bind(this.treeCopy));
						this.treeCopy.focus();
						
						if(ajaxplorer.user && !ajaxplorer.getUserSelection().hasDir()){
							var repoList = ajaxplorer.user.getRepositoriesList();	
							var index=-1;
							repoList.each(function(pair){
								var repoObject = pair.value;
								if(repoObject.allowCrossRepositoryCopy){
									index++;
									if(index) $('external_repository').show();
									if(repoObject.getId() == activeRepository) return;
									$('external_repository').insert('<option value="'+repoObject.getId()+'">'+repoObject.getLabel()+'</option>');
								}
							});							
							if(!index) return;
							$('external_repository').insert({top:'<option value="'+activeRepository+'">&lt;Current Repository&gt;</option>'});
							$('external_repository').selectedIndex = 0;
							$('external_repository').observe("change", function(e){
								externalRepo = $('external_repository').getValue();								
								this.treeCopy.src = ajxpServerAccessPath+'?get_action=ls&options=d&tmp_repository_id='+externalRepo;
								this.treeCopy.queryParameters = '&tmp_repository_id='+externalRepo;
								this.treeCopy.reload();
							}.bind(this));
						}
					}.bind(ajaxplorer.actionBar);
					var onCancel = function(){				
						ajaxplorer.cancelCopyOrMove();
					};
					var onSubmit = function(){
						var oForm = modal.getForm();						
						if(activeRepository && $('external_repository').visible() && $('external_repository').getValue() != activeRepository){
							oForm.select('input[name="get_action"]')[0].value = "cross_copy" ;
						}else{
							var eDestLabel = oForm.getElementsBySelector('input[name="dest"]')[0];
							if(eDestLabel.value == ajaxplorer.getContextNode().getPath() && oForm.select('input[name="get_action"]')[0].value=="move")
							{
								alert(MessageHash[183]);
								return false;
							}
						}
						ajaxplorer.getUserSelection().updateFormOrUrl(oForm);				
						this.submitForm(oForm);
						ajaxplorer.cancelCopyOrMove();						
						return false;
					}.bind(ajaxplorer.actionBar);
					modal.showDialogForm('Move/Copy', 'copymove_form', onLoad, onSubmit, onCancel);				
					]]></clientCallback>
				<clientForm id="copymove_form"><![CDATA[
					<div id="copymove_form" action="copy" box_width="272">
					<input type="hidden" name="dest_node" value="">
					<span id="copymove_text_span"></span>
					<div class="dialogLegend">AJXP_MESSAGE[175]</div>
					<select id="external_repository" name="dest_repository_id" style="width: 248px; font-size: 12px; height: 21px; margin-bottom: 0px; border: 1px solid #ccc;"></select>
					<div style="height:250px; width:246px; padding: 0px 0px; border: 1px solid #ccc;">
					<input type="text" name="dest" value="/" readonly  style="width:100%; border: none; border-bottom: 1px solid #ccc; background-image:none;"/>
					<div id="treeCopy" style="height:222px; padding: 3px 2px; overflow:auto; text-align:left;background-image:none;background-color:white;" class="treeCopyContainer"></div>
					</div>
					</div>
				]]></clientForm>
				<clientListener name="contextChange"><![CDATA[
				if(ajaxplorer){
					var action = ajaxplorer.getActionBar().getActionByName("copy");
					if(action){
						if(ajaxplorer.getContextNode().hasAjxpMimeInBranch("ajxp_browsable_archive")){
							action.setLabel(247, 248);
							action.setIconSrc('ark_extract.png');
						}else{
							action.setLabel(66, 159);
							action.setIconSrc('editcopy.png');
						}
					}
				}
				]]></clientListener>
				<serverCallback methodName="switchAction"></serverCallback>
				</processing>
		</action>
		<action name="move" dragndropDefault="true">
			<gui text="70" title="160" src="editpaste.png" accessKey="move_access_key" hasAccessKey="true">
				<context selection="true" dir="" recycle="hidden"
					actionBar="true" contextMenu="true" infoPanel="false"
					actionBarGroup="change" inZip="false">
				</context>
				<selectionContext dir="true" file="true" recycle="false" unique="false" image="false" mp3="false" editable="false"></selectionContext></gui>
			<rightsContext noUser="true" userLogged="only" read="true" write="true" adminOnly=""></rightsContext>
			<processing>
				<clientCallback prepareModal="true"><![CDATA[
					var onLoad = function(oForm){
						var getAction = oForm.getElementsBySelector('input[name="get_action"]')[0];
						getAction.value = 'move';
						var container = oForm.getElementsBySelector(".treeCopyContainer")[0];
						var eDestLabel = oForm.getElementsBySelector('input[name="dest"]')[0];
						var eDestNodeHidden = oForm.getElementsBySelector('input[name="dest_node"]')[0];
						$('external_repository').hide();
						if(!this.treeCopy){
							var action = function(e){
								if(ajaxplorer.actionBar.treeCopyActive){
						  			if(ajaxplorer.actionBar.treeCopyActionDest) 
						  				ajaxplorer.actionBar.treeCopyActionDest.each(function(element){element.value = this.url}.bind(this));
					 				if(ajaxplorer.actionBar.treeCopyActionDestNode) 
					 					ajaxplorer.actionBar.treeCopyActionDestNode.each(function(element){element.value = this.id}.bind(this));
					 			}
							};						
							this.treeCopy = new WebFXLoadTree('/', 
																ajxpServerAccessPath+'?get_action=ls', 
																action, 
																'explorer', null, null, '&options=d');
						}
						else{
							window.setTimeout('ajaxplorer.actionBar.treeCopy.reload()', 100);
						}				
						this.treeCopyActive = true;
						this.treeCopyActionDest = $A([eDestLabel]);
						this.treeCopyActionDestNode = $A([eDestNodeHidden]);
						$(container).insert(this.treeCopy.toString());
						$(this.treeCopy.id).observe("click", function(e){
							this.action();
							Event.stop(e);
						}.bind(this.treeCopy));
						this.treeCopy.focus();
					}.bind(ajaxplorer.actionBar);
					var onCancel = function(){				
						ajaxplorer.cancelCopyOrMove();
					};
					var onSubmit = function(){
						var oForm = modal.getForm();
						var eDestLabel = oForm.getElementsBySelector('input[name="dest"]')[0];
						if(eDestLabel.value == ajaxplorer.getContextNode().getPath())
						{
							alert(MessageHash[183]);
							return false;
						}
						ajaxplorer.getUserSelection().updateFormOrUrl(oForm);				
						this.treeCopyActive = false;
						this.submitForm(oForm);
						hideLightBox(true);
						return false;
					}.bind(ajaxplorer.actionBar);
					modal.showDialogForm('Move/Copy', 'copymove_form', onLoad, onSubmit, onCancel);					
					]]></clientCallback>
				<serverCallback methodName="switchAction"></serverCallback>
				</processing>
		</action>
		<action name="delete">			
			<gui text="7" title="161" src="editdelete.png" accessKey="delete_access_key" hasAccessKey="true">
				<context selection="true" dir="" recycle="false"
					actionBar="true" contextMenu="true" infoPanel="false"
					actionBarGroup="change" inZip="false">
				</context>
				<selectionContext dir="true" file="true" recycle="false" unique="false" image="false" mp3="false" editable="false"></selectionContext></gui>
			<rightsContext noUser="true" userLogged="only" read="true" write="true" adminOnly=""></rightsContext>
			<processing>
				<clientCallback prepareModal="true"><![CDATA[
					var onLoad = function(oForm){
				    	var message = MessageHash[177];
				    	if(ajaxplorer.getContextNode().getAjxpMime() != "ajxp_recycle"){
				    		message = MessageHash[176];
				    	}
		   		    	$(oForm).getElementsBySelector('span[id="delete_message"]')[0].innerHTML = message;
					};
					modal.showDialogForm('Delete', 'delete_form', onLoad, function(){
						var oForm = modal.getForm();
						ajaxplorer.getUserSelection().updateFormOrUrl(oForm);
						ajaxplorer.actionBar.submitForm(oForm);
						hideLightBox(true);
						return false;
					});
					]]></clientCallback>
				<clientForm id="delete_form"><![CDATA[
				<div id="delete_form" action="delete" box_width="280">
<span id="delete_message"></span>
</div>				]]></clientForm>
				<serverCallback methodName="switchAction"></serverCallback>
				</processing>
		</action>
		<action name="play_whole_folder">
			<gui text="140" title="140" src="player_play.png" accessKey=""><context selection="true" dir="" recycle="false" actionBar="false" contextMenu="false" infoPanel="true"></context><selectionContext dir="false" file="true" recycle="false" unique="true" allowedMimes="AJXP_MIMES_AUDIO"></selectionContext></gui>
			<rightsContext noUser="true" userLogged="only" read="true" write="false" adminOnly=""></rightsContext>
			<processing>
				<clientCallback><![CDATA[
					var template = new Template('<head><title>AjaXplorer MP3 Player</title></head><body style="margin:0px; padding:10px;"><div style=\"font-family:Trebuchet MS, sans-serif; color:#79f; font-size:15px; font-weight:bold;\">AjaXplorer Player</div><div style="font-family:Trebuchet MS, sans-serif; color:#666; font-size:10px; padding-bottom: 10px;">'+MessageHash[141]+': #{current_folder}</div><object type="application/x-shockwave-flash" data="AJXP_CLIENT_RESOURCES_FOLDER/flash/dewplayer-multi.swf?mp3=#{mp3_url}&amp;bgcolor=FFFFFF&amp;showtime=1&amp;autoplay=1" width="240" height="20"><param name="wmode" value="transparent"><param name="movie" value="AJXP_CLIENT_RESOURCES_FOLDER/flash/dewplayer-multi.swf?mp3=#{mp3_url}&amp;bgcolor=FFFFFF&amp;showtime=1&amp;autoplay=1" /></object></body>');
					
					var mp3Items = new Array();
					$A(ajaxplorer.getContextNode().getChildren()).each(function(nodeItem){
						var rowItem = nodeItem.getMetadata();
						var filename = rowItem.getAttribute('filename');
						if(getFileExtension(filename) == 'mp3') mp3Items.push(escape(encodeURIComponent(filename)));
					});						
					var mp3_url = '';
					var tmp_url = '';
					var limited = false;
					mp3Items.each(function(url){
						tmp_url += 'content.php?action=mp3_proxy%26file='+url;
						if(url != mp3Items.last()) tmp_url += '|';
						if(Prototype.Browser.IE && tmp_url.length > 2000){
							limited = true; return;
						}
						mp3_url=tmp_url;
					});
					if(limited){
						alert('Due to the flash player and an Internet Explorer restriction on URL length,\n only a part of the folder can be read.');
					}
					newWin = window.open('', 'mp3_multi_player', 'width=260,height=30,directories=no,location=no,menubar=no,resizable=no,scrollbars=no,status=no,toolbar=no');
					newWin.document.write(template.evaluate({mp3_url:mp3_url, current_folder:ajaxplorer.getContextNode().getPath()}));
					newWin.document.close();
					]]></clientCallback>
				<serverCallback methodName="switchAction"></serverCallback>
				</processing>
		</action>
		<action name="image_proxy">
			<gui text="6" title="158" src="applix.png" accessKey="rename_access_key"><context selection="true" dir="" recycle="false" actionBar="false" contextMenu="false" infoPanel="false"></context><selectionContext dir="true" file="true" recycle="false" unique="true" image="" mp3="" editable=""></selectionContext></gui>
			<rightsContext noUser="true" userLogged="only" read="true" write="false" adminOnly=""></rightsContext>
			<processing>
				<clientCallback><![CDATA[
					// PUT HERE CODE TO EXECUTE IN JAVASCRIPT
					]]></clientCallback>
				<serverCallback methodName="switchAction"></serverCallback>
				</processing>
		</action>
		<action name="mp3_proxy">
			<gui text="6" title="158" src="applix.png" accessKey="rename_access_key"><context selection="true" dir="" recycle="false" actionBar="false" contextMenu="false" infoPanel="false"></context><selectionContext dir="true" file="true" recycle="false" unique="true" image="" mp3="" editable=""></selectionContext></gui>
			<rightsContext noUser="true" userLogged="only" read="true" write="false" adminOnly=""></rightsContext>
			<processing>
				<clientCallback><![CDATA[
					// PUT HERE CODE TO EXECUTE IN JAVASCRIPT
					]]></clientCallback>
				<serverCallback methodName="switchAction"></serverCallback>
				</processing>
		</action>						
	</actions>
	<infoPanels>
		<infoPanel mime="no_selection" attributes="">
			<messages>
				<message key="folders_string" id="130"/>
				<message key="files_string" id="265"/>
				<message key="totalsize_string" id="259"/>
			</messages>
			<html><![CDATA[
				<div style="padding:10px;">
					<big style="font-weight: bold; font-size: 14px; color:#79f;display: block; text-align:center; padding-bottom:20px;">
						<img width="16" hspace="5" height="16" border="0" align="absmiddle" src="AJXP_CLIENT_RESOURCES_FOLDER/images/crystal/mimes/16/folder.png"/>#{current_folder}
					</big>
					<b>#{folders_string}</b> : #{filelist_folders_count}
					<br><b>#{files_string}</b> : #{filelist_files_count}
					<br><b>#{totalsize_string}</b> #{filelist_totalsize}
				</div>
			]]></html>
		</infoPanel>
		<infoPanel mime="generic_file" attributes="basename,icon,filesize,mimestring,formated_date">
			<messages>
				<message key="name_string" id="133"/>
				<message key="size_string" id="127"/>
				<message key="type_string" id="134"/>
				<message key="modif_string" id="138"/>
			</messages>
			<html><![CDATA[
			<div style="padding:10px;">
				<div class="folderImage">
					<img src="AJXP_CLIENT_RESOURCES_FOLDER/images/crystal/mimes/64/#{icon}" height="64" width="64">
				</div>
				<b>#{name_string}</b> : #{basename}
				<br><b>#{size_string}</b> : #{filesize}
				<br><b>#{type_string}</b> : #{mimestring}
				<br><b>#{modif_string}</b> : #{formated_date}
			</div>
			]]></html>
		</infoPanel>
		<infoPanel mime="generic_dir" attributes="basename,icon,formated_date">
			<messages>
				<message key="name_string" id="133"/>
				<message key="modif_string" id="138"/>
			</messages>
			<html><![CDATA[
				<div style="padding:10px;">
					<div class="folderImage">
						<img src="AJXP_CLIENT_RESOURCES_FOLDER/images/crystal/mimes/64/#{icon}" height="64" width="64">
					</div>
					<b>#{name_string}</b> : #{basename}
					<br><b>#{modif_string}</b> : #{formated_date}
				</div>
			]]></html>
		</infoPanel>
		<infoPanel mime="AJXP_MIMES_IMAGE" attributes="basename,encoded_filename,compute_image_dimensions,image_width,image_height,image_type,filesize,mimestring,formated_date">
			<messages>
				<message key="name_string" id="133"/>
				<message key="size_string" id="127"/>
				<message key="type_string" id="134"/>				
				<message key="modif_string" id="138"/>
				<message key="dim_string" id="135"/>
			</messages>
			<html><![CDATA[
				<div style="padding:10px;">
					<center style="border:1px solid #aaa; margin-bottom: 5px;">
						<img src="content.php?action=image_proxy&get_thumb=true&file=#{encoded_filename}" #{compute_image_dimensions}>
					</center>
					<b>#{name_string}</b> : #{basename}
					<br><b>#{dim_string}</b> : #{image_width}px X #{image_height}px
					<br><b>#{size_string}</b> : #{filesize}
					<br><b>#{type_string}</b> : #{image_type}
					<br><b>#{modif_string}</b> : #{formated_date}
				</div>
			]]></html>
		</infoPanel>
		<infoPanel mime="AJXP_MIMES_AUDIO" attributes="basename,escaped_filename,icon,filesize,mimestring,formated_date">
			<messages>
				<message key="name_string" id="133"/>
				<message key="size_string" id="127"/>
				<message key="type_string" id="134"/>				
				<message key="modif_string" id="138"/>
			</messages>
			<html><![CDATA[
				<div style="padding:10px;">
					<div id="mp3_container" style="text-align:center; padding:5px; width:160px;margin-bottom: 5px;">
						<object type="application/x-shockwave-flash" data="AJXP_CLIENT_RESOURCES_FOLDER/flash/dewplayer-mini.swf?mp3=content.php?action=mp3_proxy%26file=#{escaped_filename}&amp;bgcolor=FFFFFF&amp;showtime=1" width="150" height="20"><param name="wmode" value="transparent"><param name="movie" value="AJXP_CLIENT_RESOURCES_FOLDER/flash/dewplayer-mini.swf?mp3=content.php?action=mp3_proxy%26file=#{escaped_filename}&amp;bgcolor=FFFFFF&amp;showtime=1" /></object>
					</div>
					<b>#{name_string}</b> : #{basename}
					<br><b>#{size_string}</b> : #{filesize}
					<br><b>#{type_string}</b> : #{mimestring}
					<br><b>#{modif_string}</b> : #{formated_date}
				</div>
			]]></html>
		</infoPanel>
		<infoPanel mime="flv,mov,mp4,m4a,aac" attributes="basename,escaped_filename,icon,filesize,mimestring,formated_date,uri">
			<html><![CDATA[
				<div style="padding:10px;">
					<center style="border:1px solid #676965; margin-bottom: 5px;">
					<object type="application/x-shockwave-flash" data="AJXP_CLIENT_RESOURCES_FOLDER/flash/player_flv_maxi.swf" width="100%" height="200">
						<param name="movie" value="AJXP_CLIENT_RESOURCES_FOLDER/flash/player_flv_maxi.swf" />
						<param name="quality" value="high">
						<param name="allowFullScreen" value="true" />
						<param name="FlashVars" value="flv=#{uri}/content.php?action=download%26file=#{escaped_filename}&showstop=1&showvolume=1&showtime=1&showfullscreen=1&playercolor=676965&bgcolor1=f1f1ef&bgcolor2=f1f1ef&buttonovercolor=000000&sliderovercolor=000000" />
					</object>
					</center>
				</div>
			]]></html>
		</infoPanel>
	</infoPanels>
</driver>
